{% extends '::base.html.twig' %}
{% form_theme comment_form 'TrackerProjectBundle:Form:fields.html.twig' %}
{% import "TrackerHomeBundle::macros.html.twig" as UI %}

{% block title %}
    {{ "issue.page.view.title"|trans }}
{% endblock title %}

{% block body -%}
    <h3>{{ "issue.page.view.title"|trans }}</h3>

	<p>
		{% if project is empty %}
			<a href="{{ path('issue') }}">
				{{ "issue.action.back"|trans }}
			</a>
		{% else %}
			<a href="{{ path('project_issues', { 'project': project.code}) }}">
				{{ "issue.action.backProject"|trans }}
			</a>
		{% endif %}

		{% if is_granted("edit", entity) %}
			|
			<a href="{{ path('issue_edit', { 'issue': entity.code }) }}">
				{{ "issue.action.edit"|trans }}
			</a>
		{% endif %}

		{% if is_granted("create_sub_task", entity) %}
			|
			{% if project is empty %}
				<a href="{{ path('issue_new_sub_task', { 'issue': entity.code }) }}">
					{{ "issue.action.create_sub_task"|trans }}
				</a>
			{% else %}
				<a href="{{ path('project_issue_new_sub_task', { 'project': project.code, 'issue': entity.code}) }}">
					{{ "issue.action.create_sub_task"|trans }}
				</a>
			{% endif %}
		{% endif %}

		{% if entity.parent %}
			|
			{{ "issue.parent"|trans }}
			{% if project is empty %}
				<a href="{{ path('issue_show', { 'issue': entity.parent.code }) }}">
					{{ entity.parent.code }} - {{ entity.parent.summary }}
				</a>
			{% else %}
				<a href="{{ path('project_issue_show', { 'project': project.code, 'issue': entity.parent.code}) }}">
					{{ entity.parent.code }} - {{ entity.parent.summary }}
				</a>
			{% endif %}
		{% endif %}
	</p>

    <table class="record_properties table">
        <tbody>
            <tr>
                <th>{{ "issue.grid.type"|trans }}</th>
                <td>{{ entity.type.value }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.summary"|trans }}</th>
                <td>{{ entity.summary }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.code"|trans }}</th>
                <td>{{ entity.code }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.status"|trans }}</th>
                <td>{{ entity.status }}</td>
            </tr>
            <tr>
	            <th>{{ "issue.grid.resolution"|trans }}</th>
	            <td>{{ entity.resolution }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.description"|trans }}</th>
                <td>{{ entity.description }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.created"|trans }}</th>

                <td>{{ UI.formatDateAndTimeZone(entity.created) }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.updated"|trans }}</th>
	            <td>{{ UI.formatDateAndTimeZone(entity.updated) }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.reporter"|trans }}</th>
                <td>{{ entity.reporter.username }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.assignee"|trans }}</th>
                <td>{{ entity.assignee.username }}</td>
            </tr>
            <tr>
                <th>{{ "issue.grid.project"|trans }}</th>
                <td><a href="{{ path("project_show", {"project":entity.project.code }) }}">{{ entity.project.label }}</a></td>
            </tr>
        </tbody>
    </table>

    {% if activity|length > 0 %}
        <h4>{{ "issue.page.view.activity"|trans }}</h4>
        {% include 'TrackerIssueBundle:Default:partial/gridActivity.html.twig' with { 'activities': activity } %}
    {% endif %}

    {% if entity.collaborators|length > 0 %}
        <h4>{{ "issue.page.view.collaborators"|trans }}</h4>
        {% include 'TrackerIssueBundle:Default:partial/gridCollaborators.html.twig' with { 'collaborators': entity.collaborators } %}
    {% endif %}

    {% if entity.children|length > 0 %}
        <h4>{{ "issue.page.view.subTask"|trans }}</h4>
        {% include 'TrackerIssueBundle:Default:partial/gridTasks.html.twig' with { 'entities': entity.children } %}
    {% endif %}

    {% if entity.comment|length > 0 %}
        <h4>{{ "issue.page.view.comment"|trans }}</h4>
        {% include 'TrackerIssueBundle:Default:partial/gridComment.html.twig' with { 'comments': entity.comment } %}
    {% endif %}

    <h4>{{ "issue.page.view.sendComment"|trans }}</h4>

    {% if is_granted('create', entity) %}
        <a name="comment-form"></a>
        {{ form(comment_form, {'attr':{'class':"form-horizontal"}}) }}
    {% endif %}
{% endblock %}
